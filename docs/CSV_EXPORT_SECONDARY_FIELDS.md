# CSV Export Update - Secondary Project/Action Support

## Summary

Updated the CSV export functionality to include secondary project and action fields, allowing users to export complete tracking data including split projects and actions.

## Changes Made

### 1. Updated `src/settings_frame.py`

#### Modified `save_all_data_to_csv()` method:

**Active Periods:**

- Added extraction logic for secondary projects from the `projects` array
- Handles both old format (single `project` field) and new format (`projects` array)
- Extracts: `secondary_project`, `secondary_comment`, `secondary_percentage`

**Break Periods:**

- Added extraction logic for secondary actions from the `actions` array
- Handles both old format (single `action` field) and new format (`actions` array)
- Extracts: `secondary_action`, along with shared `secondary_comment` and `secondary_percentage`

**CSV Headers Updated:**
Added four new columns to the CSV output:

1. `secondary_project` - Name of the secondary project (for active periods)
2. `secondary_comment` - Comment for the secondary item (shared between projects and actions)
3. `secondary_percentage` - Percentage split for the secondary item
4. `secondary_action` - Name of the secondary action (for break periods)

### 2. Updated Tests

**Modified `tests/test_csv_export.py`:**

- Updated `test_csv_has_required_headers()` to include the new secondary fields
- Added new test class `TestSecondaryProjectActionExport` with:
  - `test_secondary_project_exported_to_csv()` - Verifies secondary project data is correctly exported
  - `test_secondary_action_exported_to_csv()` - Verifies secondary action data is correctly exported

**Created `tests/test_csv_export_manual.py`:**

- Manual test script to demonstrate the feature
- Creates sample data with both secondary projects and actions
- Generates a sample CSV file for inspection
- Verifies backwards compatibility with single project/action format

## Test Results

All 21 tests in the CSV export test suite pass:

```
Ran 21 tests in 10.765s
OK
```

## CSV Output Format

### Example with Secondary Fields:

| session_id            | type   | project          | secondary_project | secondary_comment            | secondary_percentage | break_action | secondary_action |
| --------------------- | ------ | ---------------- | ----------------- | ---------------------------- | -------------------- | ------------ | ---------------- |
| 2026-01-28_1000000000 | active | learning_to_code | documentation     | Writing docs for the project | 30                   |              |                  |
| 2026-01-28_1000000000 | break  |                  |                   | Some stretching exercises    | 40                   | bathroom     | stretching       |
| 2026-01-28_2000000000 | active | reading          |                   |                              |                      |              |                  |

## Backwards Compatibility

✓ The implementation maintains backwards compatibility:

- Old format sessions (single `project` or `action` field) work correctly
- Secondary fields are left empty for single project/action sessions
- Existing data exports without errors

## Usage

Users can now:

1. Export tracking data via Settings → "Save All Data to CSV"
2. Open the CSV in Excel, Google Sheets, or any data analysis tool
3. See complete information about split projects and actions
4. Analyze time allocation across multiple projects/actions per period

## Files Modified

1. `src/settings_frame.py` - Updated CSV export logic
2. `tests/test_csv_export.py` - Updated test headers and added new tests

## Files Created

1. `tests/test_csv_export_manual.py` - Manual verification script
2. `tests/sample_export_with_secondary.csv` - Sample output file (generated by manual test)
